# Lumina Studio 更新日志 / Changelog

## v1.6.0 (当前版本)

### 🎨 掐丝珐琅模式 (Cloisonné Mode)
- 新增掐丝珐琅模式：自动提取颜色边界生成金属丝线框
- 丝线作为独立对象导出，可在切片软件中单独指定材料
- 丝线宽度 (0.2-1.2mm) 和高度 (0.04-1.0mm) 可调
- 强制单面模式（观赏面朝上）

### 🆓 自由配色模式 (Free Color Mode)
- 新增自由配色功能：突破 LUT 色彩限制，使用任意 RGB 颜色
- 支持自定义颜色集合，每个颜色独立导出为 3MF 对象

### 🪟 透明镀层 (Coating Layer)
- 新增透明镀层功能：在模型底部添加透明保护层
- 镀层高度可调 (0.04-0.12mm)
- 作为独立对象导出，可指定透明材料

### 🔲 外轮廓 (Outline Border)
- 新增外轮廓功能：为模型添加边框
- 轮廓宽度可调 (0.5-5.0mm)
- 同时开启镀层时，轮廓自动延伸覆盖镀层高度

### 🎴 色卡模式 (Card Palette Layout)
- 新增色卡布局模式：按物理校准板的空间排列显示 LUT 颜色
- 8色 LUT 自动分为 A/B 两组并排显示
- 可在高级设置中切换色块/色卡模式

### 🔍 颜色搜索与过滤 (Color Search & Filter)
- 新增"以色找色"：ColorPicker 选色后自动匹配 LUT 中最接近的物理色
- 新增文本搜索：支持 Hex (#FF0000) 和 RGB (255,0,0) 输入，自动定位并高亮
- 新增色系过滤：按红/橙/黄/绿/青/蓝/紫/中性色分类筛选
- 匹配色块自动滚动到视野中心，带呼吸灯动效

### 🔄 颜色替换修复 (Color Replacement Fix)
- **关键修复**：颜色替换现在正确更新 material_matrix 的叠色层数据
- 使用 KDTree 查找替换色的最近 LUT 条目，获取对应的 ref_stacks（叠色配方）
- 修复了之前替换色仅影响预览但不影响 3MF 输出的问题

### 🔧 外轮廓 + 镀层兼容性修复
- 修复同时开启外轮廓和透明镀层时，第一层缺少外轮廓的问题
- 原因：镀层在 Z<0，切片器对齐后镀层占据底层，轮廓未覆盖
- 修复：轮廓厚度增加镀层高度，顶点下移覆盖完整高度

### 🚫 浮雕/掐丝珐琅互斥
- UI 上实现双向互斥：勾选掐丝珐琅自动关闭浮雕，反之亦然
- 带中英文提示信息

### 🔌 切片器集成 (Slicer Integration)
- 新增切片器一键打开：自动检测已安装的 Bambu Studio / OrcaSlicer / ElegooSlicer 等
- 生成模型后可直接在切片器中打开，无需手动拖拽
- 支持下拉切换切片器，记忆上次选择

### 🖱️ 预览交互改进
- 修复预览图点击坐标变换（适配 Gradio 6.0）
- 3D 预览全屏重新设计
- 裁剪功能新增比例预设 (1:1, 4:3, 3:2, 16:9 等)
- 记忆用户的颜色模式和建模模式选择

---

## v1.5.9

### 🧹 代码质量
- 替换所有裸异常捕获 (`except:`) 为 `except Exception:`
- 合并 PR #89

---

## v1.5.8

### 🧹 孤立像素清理 (Isolated Pixel Cleanup)
- 新增孤立像素清理功能（高保真模式自动启用）
- 智能检测并合并孤立色块，减少打印瑕疵
- 新增 Aliz PLA & PETG 4/6/8色 npy 预设

### 🏔️ 2.5D 浮雕模式 (Relief Mode)
- 新增 2.5D 浮雕模式：为不同颜色设置独立的 Z 轴高度
- 保留顶部 5 层光学叠色，底部用底板材料填充
- 自动高度生成器：按颜色明度自动分配高度（Min-Max 归一化）
- 强制单面模式（观赏面朝上）

### 🔧 底板分离 (Backing Separation)
- 新增底板分离复选框：底板作为独立对象导出
- 修复 backing 层硬编码和参数传递问题

---

## v1.5.7

### 🔧 8色模式叠色效果修复
- **核心修复**：修复 8 色模式图像转换时堆叠顺序错误导致的叠色效果不正确
- **数据一致性**：确保 8 色模式 ref_stacks 格式与 4 色、6 色保持一致 [顶...底]
- **观赏面修复**：修复观赏面 (Z=0) 和背面颠倒的问题
- 修复 RYBW 模式被错误检测为 BW 模式的问题
- 修复 RYBW 校准板颜色识别问题
- 修复 8 色手动校色合并后不持久的问题

### 🎨 完整 8 色图像转换支持
- UI 新增 8 色模式支持
- 8 色 LUT 自动检测 (2600-2800 色范围)
- 完整工作流：校准板生成 → 颜色提取 → 图像转换

### 🐳 Docker 支持
- 添加 Dockerfile 支持容器化部署

### 📐 宽高联动优化
- 宽高 Slider 输入框失焦触发联动计算，避免手动输入时频繁跳动

### 🍎 macOS 修复
- 修复 Mac 上的 UI 样式问题

### 🏗️ 4 色模式架构统一
- 统一 4 色模式架构 + 全自动测试套件
- 移除融合 LUT 功能（简化用户体验）
- 保留 BW 黑白模式
